\documentclass{revtex4}

\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\graphicspath{{figures/}}

\input{editing.tex}
\input{mynotation.tex}

\newcommand{\secref}[1]{section~\ref{#1}}
\newcommand{\Secref}[1]{Section~\ref{#1}}

\title{Artificial Production of Gravitational Waves by Localised Coherent Sources}

\begin{document}
\begin{abstract}
We correct the numerous mistakes in the literature regarding the production of gravitational waves from a collection of oscillons.
\end{abstract}
\maketitle

\section{Introduction}
In this paper we will study the effects of inconsistent notions of differentiation between the computing the source term from a given underlying field distribution.
This is the relevant case for simulations, since it is the field $\phi_i$ that are evolved directly, not the stress-energy tensor that acts as the source for the gravitational wave perturbations.
In this paper, we will not worry about how the dynamics of the fields themselves are modified by the choice of discrete stencil, but will isolate the effects of the nonlinear transformation from $\phi$ to the stress-energy tensor, followed by the (linear) projection onto TT modes of the gravitational waves.

\jb{Add estimate of $\rho_c$ to get overall amplitude of signal when oscillons dominate the background.  This changes the scaling with amplitude in the new Antusch paper since it's not independent of things like the width of the oscillons}

\jb{Disrete $\phi$ evolution will cause $\omega$ to be time-dependent as well.  This makes estimating the effects of the discrete grid difficult since we produce wavenumbers $k \sim \omega a$, and corrections look like $\omega / k_{\rm nyq}$ to various powers, which can scale purely through the modified dispersion of the discrete $\phi$ stencil.}

\jb{Add note that scaling with number of oscillons depends on whether or not they dominate energy density.  If they do, the $N_{\rm osc}$ enhancement cancels with critical density, otherwise there is a suppression factor for density in oscillons to overall energy density.}
\section{Pointless Notes}
Think a bit about what time integration errors do (for long time runs lots of time-stepping algorithms will will constantly violate things like energy conservation, which will modify the amplitude of $h_{ij}$ and in long time runs this can accumulate.

\jb{Somewhere need to add that the mechanism studied here is based on long-time integrations, and therefore even if there are multiple sources at discrete frequencies, these will be smoothed out.  This is \emph{not} an analytic calculation of the multipeak structure that results from the nonlinear fracturing of the field into oscillons, which happens on time-scales much less than an e-fold.}

\section{Numerical Approach to Extraction of Gravitational Waves}
In the standard approach, calculation of gravitational waves sourced by stongly nonequilibrium and inhomogeneous scalar field dynamics is done in a two step process (for an exception see~\cite{Huang:HLattice,Bastero-Gil}.
Here we briefly outline this approach, restricting ourselves to the case of canonical kinetic terms for the scalar fields for simplicity.

First, the scalar field dynamics is evolved from set specified initial condition using
\begin{equation}
  \label{eqn:scalar-eom}
  \ddot{\phi}_i + 3H\dot{\phi} - \nabla^2\phi + \frac{\partial V}{\partial \phi_i} = 0 \, .
\end{equation}
Depending on the application, the Hubble parameter may be externally imposed or else solved self-consistently.
\jb{Comment that laplacian and grad squared are already constrained.}
The standard approach then considers the linear response of the gravitational perturbations to these dynamically evolving fields, ignorning all backreaction and rescattering effects of the metric perturbations.
Technically, the metric is written in synchronous gauge as
\begin{equation}
  ds^2 = -dt^2 + a^2(t)(\delta_{ij} + h_{ij})dx^idx^j
\end{equation}
and the solution of~\eqref{eqn:scalar-eom} is treated as an external input to evolve the transverse traceless projection of $h_{ij}$
\begin{equation}
  \label{eqn:sourced-h-tt}
  \ddot{h}_{ij}^{TT} + 3H\dot{h}_{ij}^{TT} - \nabla^2h_{ij}^{TT} = \frac{1}{a^2}\left[\partial_i\phi\partial_j\phi\right]^{TT}
\end{equation}
where ${}^{TT}$ indicates the transverse-traceless (TT) projection of a given tensor.
\jb{Write metric perturbations}
In the continuum, this is defined by
\begin{equation}
  \label{eqn:tt-proj}
  S_{ij}^{TT} = \proj_{ij,lm}^{TT}S_{lm}
\end{equation}
with
\begin{equation}
  \label{eqn:proj-TT}
  \proj_{ij,lm} = P_{il}P_{jm} - \frac{1}{2}P_{ij}P_{lm}
\end{equation}
and
\begin{equation}
  \label{eqn:proj-simple}
  P_{ij} = \delta_{ij} - \hat{k}_i\hat{k}_j
\end{equation}
for an arbitrary symmetric tensor $S_{ij}$.
In practice,~\eqref{eqn:sourced-h} is rarely solved directly.
Instead, the unprojected equation
\begin{equation}
  \label{eqn:sourced-h-full}
  \ddot{h}_{ij} + 3H\dot{h}_{ij} - \nabla^2h_{ij} = a^2\partial_i\phi\partial_j\phi
\end{equation}
with $h_{ij}^{TT}$ obtained by applying the TT projection to the resulting solution.
Furthermore, the projection is usually done in Fourier space, with $h_{ij}$ evolved in real space using some discrete approximation to the Laplacian operator.
\emph{In the continuum}, these two approaches are equivalent. \jb{Check discrete case for commutativity.}

Of course, to put these equations on a finite computer, discretization choices must be made for both the time-coordinate and the spatial coordinates.
Our focus in this paper will be on the effects of spatial discretization on the extracted signal, so for the purposes of illustration we will assume a time-integrator with perfect accuracy.
Examples which have been demonstrated to achieve $\mathcal{O}(10^{-14})$ accuracy in nonlinear scalar field dynamics after inflation and during first-order phase transitions include symplectic Yoshida~\cite{} and Gauss-Legendre~\cite{} schemes.
The former has the advantage of being explicit and not requiring temporary storage of copies of the entire lattice.
At any rate, for any reasonable choice of integration scheme, improved temporal accuracy can be achieved through decreased time step at the cost of additional CPU cycles.
Improved spatial resolution, however, requires either implementation of an improved discretization scheme, or else an increase in the amount of memory to store the simulation data.
This is a far more severe computational burden, so in many applications the spatial convergence is the key consideration.
As well, on modern computer and cluster architectures, communication and memory access costs tend to be the limiting factors in computational speed, which are themselves often determined by the total amount of memory required by a simulation.
Similarly, when running simulations using GPGPU computing, transfer of data between the internal GPU memory and the CPU is orders of magnitude slower than evaluation of computational kernels, and communication between various levels of the GPU memory cache are often the speed limiting step.
Furthermore, maintaining an equivalent level of temporal accuracy requires holding the Courant step $dx/dt$ fixed, so a decreased grid-spacing must be accompanied by a corresponding decrease in $dt$. \jb{Some comment about conditions for this to be true.  When lattice sims are needed because a large dynamical range of interacting modes are relevant, this is the case.  When some background evolution provides the relevant timescale (say during early stages of preheating), it may not be the case.  However, lattice sims aren't needed for the linear stage (with a minor extension of the usual initial conditions).}

Examining the preceding formalism, we see that discrete derivatives must be defined in four distinct places:
\begin{enumerate}
\item the Laplacian acting on $\phi_i$,
\item the Laplacian acting on $h_{ij}$,
\item the derivatives in $T_{ij}$, and
\item in the projection operator.
\end{enumerate}
Although not obvious from the equations of motion, these definitions are all intrinsically linked to each other, and systematic errors will be introduced if the various derivative operators are not properly related to each other.
For example, in the case $\nabla^2\phi$ and $T_{ij}$ the correlation between the definitions occurs because the they both arise from variation of
\begin{equation}
  \frac{1}{2a^2}\left(\delta^{ij}+h^{ij}\right)\partial_i\phi\partial_j\phi
\end{equation}
in the action.
However, this basic fact is often overlooked in the literature, so we will consider the effects of treating each derivative operator independently.
\jb{Fix notation for the inverse metric operator}
In this paper, we will explicitly quantify these errors and examine the consequences for the case of long-lived scalar field configurations with fixed frequncies.
A particular example of relevance to the recent literature is the case of oscillons produced after inflation.

\section{TT Projections and the SVT Decomposition of a 3-tensor}
Given a symmetric matrix $S_{ij}$, the transverse traceless (TT) projection can be obtained by applying the projection operator operator
\begin{align}
  \label{eqn:tt-proj-fourier}
  \proj^{TT}_{ij,lm} &= P_{il}P_{jm} - \frac{1}{2}P_{ij}P_{lm} \\
  P_{ij} &= \delta_{ij} - \hat{k}_i\hat{k}_j \, .
\end{align}
Here, we have expressed the projector in Fourier space, which assumes that the action of a derivative operator in Fourier space can be obtained by the replacement $\partial_i \to ik_i$.
As we will see shortly, this naive replacement fails for a wide range of numerical approximation schemes based on lattice discretizations of a continuous system.
Below we will derive the appropriate real space version of the TT projector~\eqref{eqn:tt-proj-fourier}, and its generalization to Fourier space.

To derive~\eqref{eqn:tt-proj-fourier}, it is convenient to consider the standard SVT decomposition of an arbitrary symmetric matrix $S_{ij}$
\begin{equation}
  S_{ij} = \frac{S}{3}\delta_{ij} + \left(\partial_i\partial_j - \frac{1}{d}\delta_{ij}\nabla^2\right)S^{(S)} + (\partial_iS_j^{(V)} + \partial_jS^{(V)}_i) + S_{ij}^{(TT)} \, .
\end{equation}
For notational convenience, we also define the trace-free projection
\begin{equation}
  \bar{S}_{ij} = S_{ij} - \frac{\delta_{ij}}{d}S \qquad S = S_{ii} \, .
\end{equation}
The various components can be obtained from the original matrix through the projection operators
\begin{subequations}
\begin{align}
  \proj^{Tr,\parallel}_{ij,lm} &\equiv \frac{1}{d}\delta_{ij}\delta_{lm} \\
  \proj^{(S),\parallel}_{ij,lm} &\equiv \frac{d}{d-1}\left(\partial_i\partial_j - \frac{1}{d}\delta_{ij}\nabla^2\right)\nabla^{-4}\left(\partial_l\partial_m - \frac{1}{d}\delta_{lm}\nabla^2\right) \\
  \proj^{(S),\perp}_{ij,lm} &= \delta_{il}\delta_{jm} - P^{(S),\parallel}_{ij,lm} \\
  \proj^{(V),\parallel}_{ij,lm} &\equiv (\delta_{ia}\partial_j + \delta_{ja}\partial_i)\nabla^{-2}\partial_b\left(\delta_{al}\delta_{bm} - \proj^{(S),\parallel}_{ab,lm} - \proj^{Tr,\parallel}_{ab,lm}\right) \\
  \proj^{(V),\perp}_{ij,lm} &= \delta_{il}\delta_{lm} - P_{ij,lm}^{(V),\parallel} \, .
\end{align}
\end{subequations}
Here ${}^\parallel$ indicates the projection onto solely the given component of the matrix and ${}^{\perp}$ the orthogonal projection.
We obtain the TT projection through repeated removal of individual components
\begin{align}
  \mathcal{P}_{ij,lm}^{(T)} &= \left(\delta_{ia}\delta_{jb} - \proj^{(V),\parallel}_{ij,ab}\right)\left(\delta_{am}\delta_{bn}-\proj_{ab,mn}^{(S),\parallel}\right)\left(\delta_{ml}\delta_{nm}-\proj_{mn,lm}^{Tr,\parallel}\right) \\
  &=  \delta_{il}\delta_{jm} - \proj_{ij,lm}^{(V),\parallel} - \proj_{ij,lm}^{(S),\parallel} - \proj_{ij,lm}^{Tr,\parallel}
\end{align}

The scalar potential ($S$) and vector potential $S_i$ are easily obtained by solving
\begin{subequations}
  \begin{align}
    \nabla^4 S^{(S)} &= \frac{d}{d-1}\partial_i\partial_j\bar{S}_{ij} \\
    \nabla^2 S_i^{(V)} &=
  \end{align}
\end{subequations}

We now assume we work in the continuum, and that we can treat the system as periodic so the inverse Laplacian operators are easily expressed in terms of wavenumbers.
To extract the total scalar contribution (the trace and $S^{(S)}$), we can use the projection
\begin{equation}
   \proj^{{\rm scalar}}_{ij,lm} = \proj_{ij,lm}^{(S),\parallel} + \proj_{ij,lm}^{Tr,\parallel} = \frac{1}{2}P_{ij}P_{lm} + \hat{k}_i\hat{k}_j\hat{k}_l\hat{k}_m \, .
\end{equation}
Except for the term involving 4 momenta, this is the second term in the representation~\eqref{eqn:}.
To obtain the projector onto the vector modes, first define
\begin{equation}
  Q^{(V)}_{ij,lm} = \hat{k}_i\hat{k}_l\delta_{jm} + \hat{k}_j\hat{k}_l\delta_{im}
\end{equation}
which satisfy
\begin{equation}
  Q^{(V)}_{ij,ab}\proj^{{\rm scalar}}_{ab,lm} = 2\hat{k}_i\hat{k}_j\hat{k}_l\hat{k}_m
\end{equation}
from which we immediately obtain (using the symmetry of the projector)
\begin{equation}
  \proj_{ij,lm}^{(V)} = \hat{k}_i\hat{k}_l\delta_{jm} + \hat{k}_j\hat{k}_m\delta_{il} - 2\hat{k}_i\hat{k}_j\hat{k}_l\hat{k}_m = -P_{il}P_{jm} + \delta_{il}\delta_{jm} - \hat{k}_i\hat{k}_j\hat{k}_l\hat{k}_m \, .
\end{equation}
For convenience in future calculations, we write explicitly
\begin{subequations}
\begin{align}
  S_{ij}^{\rm scalar} &= \frac{\delta_{ij}}{2}\left(S_{ll} - \hat{k}_lS_{lm}\hat{k}_m\right) - \frac{\hat{k}_i\hat{k}_j}{2}\left(S_{ll} - 3\hat{k}_lS_{lm}\hat{k}_m\right) \\
  S_{ij}^{(V)} &= \hat{k}_i\hat{k}_lS_{lj} + \hat{k}_j\hat{k}_lS_{li} - 2\hat{k}_i\hat{k}_j\hat{k}_lS_{lm}\hat{k}_m \\
  S_{ij}^{(T)} &= S_{ij} - \hat{k}_iS_{jl}\hat{k}_l - \hat{k}_jS_{il}\hat{k}_l + \frac{1}{2}\delta_{ij}\left(\hat{k}_lS_{lm}\hat{k}_m - S_{ll}\right) + \frac{1}{2}\hat{k}_i\hat{k}_j\left(S_{ll}+\hat{k}_lS_{lm}\hat{k}_m\right) \\
\end{align}
\end{subequations}
from which we see we require the following three contractions $S_{ii}$, $\hat{k}_lS_{li}$ and $\hat{k}_lS_{lm}\hat{k}_m$ of $S_{ij}$.
It is also straightforward to verify that $S_{lm}^{(T)} = \bar{S}_{lm}^{(T)}$ so that we are free to first remove the trace of $S_{ij}$ if we want.

Using these expressions, we immediately obtain the original result for the TT projector,
but now we have clarified the connection between the full SVT decomposition of a symmetric matrix $S_{ij}$ and the projection onto the TT components.
Furthermore, it is straightforward to see
\begin{equation}
  \proj_{ij,lm}^{(T)}\proj_{ij,ab}^{(T)} = \proj_{lm,ab}
\end{equation}
which allows us to express
\begin{equation}
  S_{ij}^{(T)}S_{ij}^{(T)} = S_{ij}S_{ij} - 2\hat{k}_iS_{il}S_{lj}\hat{k}_j + \left(\hat{k}_iS_{ij}\hat{k}_j\right)^2 - \frac{1}{2}\left(S_{ii}-\hat{k}_iS_{ij}\hat{k}_j\right)^2
\end{equation}
in terms of the four scalar quantities $\mathrm{Tr}(S), \mathrm{Tr}(S^2), \hat{k}^TS\hat{k}$, and $\hat{k}^TS^2\hat{k}$.
As we will see below, this quantity is of central importance when computing the GW spectrum from a long-lived source with fixed frequency.

However, despite this apparent simplicity, it should be clear that caution must be exercised when working with a discretised system, in particular when the derivative operators appearing in the projection are approximated by means other than properly resolved pseudospectral or spectral methods.
To see how problems may arise, notice that to extract the trace-free scalar part of $S_{ij}$, we must invert the operator $\nabla^4$.
For periodic systems with exact derivatives, this is easily done in Fourier space by simply dividing by $k^4$.
However, when finite-difference approximations are used, the operator inversion becomes a large matrix inversion problem.
The key point is that the eigenvalues of the discrete operator approximation $\nabla^4$ will, in general, differ from the continuum values.
For example, with the stencil
\jb{write the general stencil}
we have
\jb{write what this looks like.  Product of sines and cosines.}
\jb{Is $\nabla^{-2}\nabla^{-2} = \nabla^{-4}$ in the discrete case?}
\jb{Discrete derivatives don't satisfy the product rule or chain rule, so many of the manipulations used to obtain a factorized operator are extremely suspicious outside of the continuum since they rely of commuting $k$'s in momentum space or derivatives in real space.}

\section{Gravitational Waves from Sources of Fixed Frequency}
We now compute GWs produced in an expanding FRW background.
We first review the continuum Green's function formalism for computing the production of GWs from a given stress-energy source~\cite{Dufaux:2007pt}.
This formalism is well suited to the analytic investigations we perform here.
In order to investigate lattice effects, we will then extend this formalism to the case of discrete lattice stencils for the $h_{ij}$ Laplacian.

The energy density in gravitational waves is given by
\begin{equation}
  \rho_{\rm GW} = \frac{M_P^2}{4}\left\langle\dot{h}_{ij}^{\rm TT}\dot{h}_{ij}^{TT}\right\rangle_V
\end{equation}
where $\langle\cdot\rangle_V$ indicates a spatial average over several wavelengths of the tensor perturbations.

\jb{Review derivation.  Indicate where approximate GF are used.}
Using Green's function techniques, we can show the fractional energy density in gravitational waves per comoving wavenumber is
\begin{equation}
  \Omega_k^{GW}({\bf k}) = \frac{1}{3M_P^2H^2}\frac{d\rho_{\rm GW}}{d\ln k} \approx \frac{1}{6M_P^4H^2a^4V}S_k
\end{equation}
with
\begin{equation}
  S_k = k^3\int \frac{d\Omega_k}{(2\pi)^2}\sum_{ij}\left(\left|\int_{\tau_i}^\tau d\tau'\cos(k\tau')\tij({\bf k},\tau')\right|^2 + \left|\int_{\tau_i}^\tau d\tau'\sin(k\tau')\tij({\bf k},\tau')\right|^2 \right)
\end{equation}
where $\tau$ is the conformal time, $k$ the comoving momentum, and $V$ the comoving volume we average over.
In the above derivation, it is assumed the GWs initially satisfy $h_{ij}=\dot{h}_{ij}=0$ with the source turning on at time $\tau_i$.
We have also assumed the subhorizon limit so $k^2 \gg a^2H^2$ and approximate Green's functions can be used that neglect some subleading effects of the expansion of the Universe.
For sufficiently long-lived sources, these subleading corrections may need to be included.
\jb{Quantify this.}

\subsection{Gravitational Wave Production on a Lattice}
\jb{Move derivation below up here}

\section{GW Production from Sources of Fixed Narrow-Band Frequency}\label{sec:gw-narrow-band}
\jb{Generalize this to $\omega(t)$ instead of linear in time}
We must now adopt a model for the source $\tij$.
To explore the effects of a source with fixed frequency (in cosmic time), we assume
\begin{equation}
  \phi({\bf x},t) = \prof({\bf x},t)\cos(\omega t)
\end{equation}
with $\prof$ some profile function with non-oscillatory and smooth temporal behavior.
We thus have
\begin{equation}
  \tij({\bf x},t) = \tijNoT({\bf x},t)\cos^2(\omega t) \, .
\end{equation}
Consideration of multiple harmonics is straightforward, although somewhat messier.
Similarly, the extension to time varying frequencies $\omega(t)$ is obvious but requires more involved derivations than those before.

The trigonometric functions can be reexpressed as
\begin{subequations}
\begin{align}
  \cos k\tau\cos^2\omega t &= \frac{1}{4}\cos(k\tau-2\omega) + \frac{1}{4}\cos(2\omega t+k\tau) + \frac{1}{2}\cos k\tau \\
  \sin k\tau\cos^2\omega t &= \frac{1}{4}\sin(k\tau-2\omega) + \frac{1}{4}\sin(2\omega t+k\tau) + \frac{1}{2}\sin k\tau \, .
\end{align}
\end{subequations}
The dominant contributions to the integrals come from the sinusoids of $2\omega t - k\tau$, which have stationary points in their evolution when
\begin{equation}
  k = 2\omega\frac{dt}{d\tau} = 2\omega a \, .
\end{equation}
Assuming smooth (non-oscillatory) behaviour in $a$ and $\tijNoT$, we can approximate
\begin{equation}
  \label{eqn:cosine-int}
  \cosInt \equiv \int_{\tau_i}^\tau d\tau' a(\tau')\tijNoT(\kvec,\tau')\cos k\tau'\cos^2\omega t \approx \sqrt{2\pi}\frac{a_k\tijNoT(\kvec,\tau_k)}{4\sqrt{2\omega a^2_kH_k}}\cos\left(k\tau_k - 2\omega t_k -\frac{\pi}{4}\right)\Theta(\tau - \tau_k)\Theta(\tau-\tau_i)
\end{equation}
and
\begin{equation}
  \label{eqn:sine-int}
  \sinInt \equiv \int_{\tau_i}^\tau d\tau' a(\tau')\tijNoT({\kvec},\tau')\sin k\tau'\cos^2\omega t \approx \sqrt{2\pi}\frac{a_k\tijNoT(\kvec,\tau_k)}{4\sqrt{2\omega a^2_kH_k}}\sin\left(k\tau_k - 2\omega t_k -\frac{\pi}{4}\right)\Theta(\tau - \tau_k)\Theta(\tau_i-\tau)
\end{equation}
where $\Theta(x)$ is the Heaviside step function.
An improved estimate of the amplitude can be obtained by more carefully treating the time-dependence of $\tijNoT$ and $a$ around the stationary point.
Similarly, the oscillations and small changes to the overall amplitude can be obtained by accounting for boundary terms and subleading corrections in the asymptotic expansion.
\jb{Improve this estimate to include subleading behaviour in $k$.}
Notice the tremendous simplification that occurs in the temporal integrals due to the narrow and fixed bandwidth of the source.
If the source instead contains many frequencies, then interference between GWs produced at different times can be significant and the source will not in general factor out of the expression.
\jb{Note that if we integrate for too long, the $\cos\tau$ and $\sin\tau$ terms might also contribute instead of simply integrating to zero on average.  This isn't an issue in any case I've checked so far.  However, in this limit we might also need to use more accurate Green's functions and include the other corrections from the Hubble in $\rho_{\rm GW}$.  This seems to be completely negligible over reasonable time-scales.}

\begin{figure}
  \includegraphics[width=3.375in]{{{stationary-phase-check}}}
  \caption{Some plots illustrating the accuracy of the stationary phase approximation and various improvements to it.  Here, we have fixed the background cosmology to be fixed with $w=0$ and $H_0 = 0.1\omega$, and study the integrals~\eqref{eqn:} for $\omega^{-1}k = 8$.  We show the results for the $\cos$ (\emph{red}) and $\sin$ (\emph{blue}) integrals separately, and for the squared sum (\emph{black}).  The light solid line is the full integral, the dark solid line is keeping only th $\cos(k\tau - 2\omega t)$ (or $\sin$) contribution, and the dashed lines are the analytic approximations~\eqref{eqn:cosine-int}and~\eqref{eqn:sine-int}.  For simplicity, we have taken $\tijNoT$ to have no time dependence.  Our approximation accurately captures the behaviour averaged over a few oscillations of the waves. \jb{Add step function behaviour in.  Improve analytic estimate.  Do the same thing for some scaling profiles, in particular $a^{-1}$ behaviour will damp the post production oscillations.}}
\end{figure}

Here the subscript ${}_k$ indicates that the given quantity is evaluated at the conformal time $\tau_k$ when
\begin{equation}
  2\omega\frac{dt}{d\tau} = k \qquad a(\tau_k) = \frac{k}{2\omega} \, .
\end{equation}
Squaring and summing, we find
\begin{equation}
  S_k \approx \frac{\pi}{16\omega}k^3\int \frac{d\Omega_k}{(2\pi)^2} H_k^{-1}\sum_{ij}\left|\mathcal{T}_{ij}({\bf k},\tau_k)\right|^2\Theta(2\omega a - k) \, .
\end{equation}
where we have allowed an angular dependence in $H_k^{-1}$ for reasons that will be clear below.
We immediately note there is a sharp cutoff in the spectrum at $k = 2\omega a$.
Moving beyond the approximation used here, the stationary phase contribution will have a short period of time during which it turns on (of width $\sqrt{2\omega a'} = \sqrt{2\omega a^2 H}$), which smooths the step function slightly, but still leaves a rapidly decreasing function beyond the cutoff.

\subsection{Scaling Profile Solutions}
We now consider the morphology of $\Omega_{\rm GW}$ for some special cases of cosmological evolution and the source term $\tij$.
Given a scaling form for the profile
\begin{equation}
  \prof(\xvec,t) = a^{-\alpha} \prof_0(a^\beta\xvec)
\end{equation}
we obtain the following scaling relationship for $\tijNoT$
\begin{equation}
  \tijNoT(\xvec,t) = a^{-2\alpha+2\beta}\tijNoT(a^\beta\xvec)
\end{equation}
and for its Fourier transform
\begin{equation}
  \tilde{\tijNoT}(\kvec,t) = a^{-2\alpha-\beta}\tilde{\tijNoT}(a^{-\beta}\kvec,t=0)
\end{equation}
where we have assumed three spatial dimensions in the scaling of the Fourier transform.
As an important special case, $\beta=1$ corresponds to a field profile of fixed physical size.
Although we focus on the case where the field is oscillating in time, it should be clear that with minor modifications the results presented here can be easily extended to the case where $\tij$ directly undergoes oscillations and the scaling occurs directly in $\tijNoT$.

As a further simplification, we also consider a Universe dominated by a fluid with constant equation of state $w$ so that
\begin{equation}
  H = H_0 \left(\frac{a}{a_0}\right)^{-\frac{3}{2}(1+w)}
\end{equation}
and $a$, $\tau$ and $t$ are related by
\begin{subequations}
\begin{align}
  a(t)    &= a_0\left(1 + \frac{3}{2}(1+w)H_0t \right)^{\frac{2}{3(1+w)}}\\
  \tau(t) &= \frac{2}{H_0(1+3w)}\left[\left(1+\frac{3}{2}(1+w)H_0t\right)^{\frac{3w+1}{3(1+w)}} - 1 \right] \, .
\end{align}
\end{subequations}
\jb{These assume $t_i = \tau_i = 0$.  Apply trivial fix for arbitrary starting times.}


Denoting the time when the scaling of the profile begins by $\tau_i$, we obtain the following
\begin{equation}
  \Omega_{\rm GW} \approx \frac{\pi}{12}\left(\frac{\phi_0}{M_P}\right)^4\frac{1}{H_0^3V}\sigma^2\omega^2\left(\frac{k_{\rm pivot}}{2\omega a}\right)^{n_{\rm GW}}a^{n_{\rm GW} - 1 + 3w}\left(\frac{k}{k_{\rm pivot}}\right)^{n_{\rm GW}} \tilde{F}_0 \Theta(k-2\omega a_i)\Theta(2\omega a - k)
\end{equation}
with
\begin{equation}
  n_{\rm GW} = \frac{5}{2} + \frac{3}{2}w - 2(\beta-1) - 4\alpha 
\end{equation}
and we have assumed the scale factor is $1$ initially.
In the above, we have defined
\begin{equation}
  \frac{1}{(2\pi)^3}\int d\Omega \sum_{i,j}\left|\tilde{\tijNoT}\left((2\omega)^\beta \kvec^{\beta-1},t=0\right)\right|^2 = \phi_0^4\sigma^2 \tilde{F}_0(\kvec,\omega) \, ,
\end{equation}
with $\phi_0$ a parameter characterizing the amplitude of the field oscillations and $\sigma$ a characteristic length scale.
One particular case of interest is an oscillon, where $\phi_0$ is the amplitude of the oscillations at the center of the oscillon, and $\sigma$ is the width of the oscillon profile.\footnote{Here we are assuming an oscillon profile characterized by a single with $\sigma$.}
With the case of a collection of oscillons in mind, we notice that for field profile of fixed physical size ($\beta=1$) and matter dominated expansion ($w=0$), a spectral slope greater that $\frac{5}{2}$ requires the presence of a \emph{growing} source (i.e.\ $\alpha < 0$).
Furthermore, in order for the amplitude at the cutoff ($k=2\omega a$) to increase with time, we must have
\begin{equation}
  \frac{3}{2} + \frac{9}{2}w - 2(\beta-1) - 4\alpha > 0 \, .
\end{equation}
\jb{Fix the step functions.}
\jb{Reexpress the normalization of $k$ to $a^\beta$ instead of just $a$?}

\jb{This also matches the result in the Antusch paper except for a $10\%$ error in the amplitude for the asypherical Gaussian, once their result for $\kappa$ in (4.19) is corrected (doing any sort of linear regression with various fixes to the obviously incorrect fourth entry in their Table 1 gives something close to 9.32 instead of their answer).}

\jb{Generalize this to time-dependent $\omega$ since the derivation is essentially unchanged.}
\jb{Generalize the scaling to two arbitrary functions instead of $\alpha$ and $\beta$ for the since frequency case.}
\jb{Do a quick redo of the ``semi-analytic'' calculations from the Antusch paper to see if there is any oscillation in the amplitude as the output scale factor is adjusted, or if these oscillations in the amplitude on top of the stationary phase approximation average out when doing the angular integrals.  The only angular dependence that has to be pulled inside the integrals is the part appearing in the Gaussian.}

\subsection{GWs from a collection of localized sources}
The above result holds for an arbitrary scalar field profle $\prof({\bf x},t)$ that oscillates with a single characteristic frequency $\omega$.
As derived, the scalar profile need not be spatially localized, and it is straightforward to generalize to the case of $N$ distinct oscillation frequencies or the case of a time-dependent frequency $\omega(t)$.\footnote{Assuming of course the time-dependence doesn't remove the stationary point in the phase evolution, such as if $\omega(t) = \omega_\eta\eta$.}
However, a natural cosmological scenario where such narrow-band oscillations occur is from a collection of oscillons produced by the nonperturbative decay and subsequent inhomogeneous nonlinear evolution of a scalar field.

Motivated by this, consider the case where the profile $\prof$ is a collection of $N$ localized blobs of the field $\phi$
\begin{equation}
  \phi = \sum_{n=1}^{N} P_n({\bf x-x}_n,t)\cos\left(\omega_n(t-t_n)\right)
\end{equation}
where the $P_n$'s are some set of profile functions and ${\bf x}_n$ label the centers of the local blob of field configuration.
We have generalized the time-dependence slightly to allow each blob to oscillate with a different phase.
Assuming that $P_{n_1}({\bf x-x}_{n_1},t)P_{n_{2}}({\bf x - x}_{n_2},t) \ll 1$ for $n_1 \neq n_2$, the interactions between the various blobs can be ignored, and
\begin{equation}
  T_{ij}({\bf x}) = \sum_{n=1}^N\partial_iP_n({\bf x-x}_n)\partial_jP_n({\bf x-x}_n)\cos^2(\omega_n(t-t_n))
\end{equation}
with Fourier transform
\begin{equation}
  \tilde{T}_{ij}(\kvec) = \sum_{n=1}^Ne^{i\kvec\cdot\xvec_n}\cos^2(\omega_n(t-t_n))\tilde{T}_{ij,n}(\kvec)
\end{equation}
where
\begin{equation}
  \tilde{T}_{ij,n}(\kvec) \equiv \int \ud[3]{\xvec}e^{i\kvec\cdot\xvec}\partial_iP_n(\xvec)\partial_jP_n(\xvec) \, .
\end{equation}
\jb{Check sign on phase factor.}

The locations of the individual sources are encoded in the $e^{i\kvec\cdot\xvec_n}$ factors.
\jb{This is awkward wording.}
Note that for the case of preheating, the final positions and momenta of the oscillons are ultimately determined by the initial realization of the random field used to run the simulation.
Therefore, the ``stochasticity'' effects induced by the finite number of sources can ultimately be traced back to the stochasticity of the initial conditions.

In order to gain some intuition about the effects of the phase factors,
we now consider the case where all the sources have identical profiles and oscillation phases $\omega_nt_n = \omega t_0$, so that $\tilde{\mathcal{T}}_{ij,n} = \tilde{\mathcal{T}}_{ij,0}$ and the stress-energy tensor factorizes
\begin{equation}
  \tilde{T}_{ij}(\kvec) = \tilde{\mathcal{T}}_{ij,0}(\kvec)\cos^2(\omega (t-t_0)) \sum_{n=1}^N e^{i\kvec\cdot\xvec_n} \, .
\end{equation}
For simplicity, we now further assume that the positions $\xvec_n$ are time-independent.
A simple model for the gravitational waves produced by the relative motion of the sources can be obtained by allowing $x_n = x_n(t)$.
With these assumptions, the factor $\sum e^{i\kvec\cdot\xvec_n}$ comes outside the temporal integrals, and there is an overall form-factor multiplier
\begin{equation}
  F(\kvec) \equiv \left|\sum_{n=1}^N e^{i\kvec\cdot\xvec}\right|^2 \, .
\end{equation}
For example, in the case of two objects with separation $\Delta\xvec = \xvec_2-\xvec_1$, we have
\begin{equation}
  F_2(\kvec) = 4\cos^2\left(\frac{\kvec\cdot\Delta\xvec}{2}\right) = 2\left(1 + \cos\left(\kvec\cdot\Delta\xvec\right)\right) \, .
\end{equation}
In a finite box of length $L$ with $N$ lattice sites, $F_2\left(\frac{2\pi \myvec{i}}{L}\right)$ is invariant under the change $\Delta\xvec \to L - \Delta\xvec$ for $\myvec{i}\in \mathbb{Z}^3$, as it must be.
\jb{Fix $L$ notation here.}
To gain some further intuition, let's assume that each source is radiating isotropically (so that $|\tijNoT|^2$ has no angular dependence in momentum space.
In this case, we can fully encapsulate the effect of $F_2$ by averaging over all angles
\begin{equation}
  \label{eqn:form-2-averaged}
  \frac{1}{4\pi}\int d\Omega F_2 = 2\left(1 + \frac{1}{kr}\sin\left(kr\right)\right)
\end{equation}
where we have defined $r \equiv |\Delta\xvec|$.
Consider the simple case where the two oscillons are located along the x-axis.
The angle-averaged form factor \eqref{eqn:form-2-averaged} is \emph{not} invariant under $r \to L - r$ when evaluated at the lattice momenta, because performing a DFT in a finite box automatically implies a periodic extension of the system.
For the case of two objects, this then implies an infinite line of such objects, which is highly anisotropic and of course shows up in the numerically computed spectrum from the lattice.
This indicates that some care must be taken when interpreting the GW signal using numerical simulations which produce a sparsely sampled population of objects.
\jb{Having said this, it just induces small oscillations around $2$ with period not much different than the separation in k-vectors, so it's not like the overall shape of the signal is affected much.  However, for only a few oscillons per Hubble, shot noise like effects might matter.}
\jb{How does the box periodicity show up when we angle average this on a rectangular lattice?  Does it come from the discrete sampling in the angles somehow, since $\Delta x \to L - \Delta x$ doesn't evaluate to the same values anymore.  Go through this carefully to check, and understand what's breaking it.}

More generally, for $N$ objects we define the $N$ separations $\Delta\xvec_i \equiv \xvec_i-\xvec_1$ to obtain
\begin{equation}
  F_N(\kvec) = 
\end{equation}
In the special case that the individual locations $x_n$ are drawn uniformly in the interval $[0,L]$ and $k = 2\pi i / L$, then each individual phase factor is a Gaussian Random Deviate with unit variance \jb{or is it 2 (Check)?}.
Therefore, the ensemble average of $F_N$ in this case is given by the number of individual blobs $N$, with the stochastic locations of the individual sources in a given realization leading to oscillations around this mean rescaling.
This basic structure is modified when the oscillon locations have non-trivial correlations (which we expect to be true in many cases of dynamical interest, such as oscillons generated through nonlinear fracturing after parametric resonance).
\begin{figure}
  \caption{Add some figures showing typical form functions if we randomly sample the oscillon positions in various ways.}
\end{figure}
\jb{Using peak statistics of a GRF, can get an approximation for the correlations of the oscillons by getting the peak-peak correlations constrained to be above a threshold and with some band of widths.}
\jb{Change this to 3D not 1D.  Also, ensemble averaging is probably not very useful from a lattice sim viewpoint, but is relevant to a detector with no directional sensitivity.}

\jb{See if the expansion $e^{ik\cos\theta} = \sum_{n=-\infty}^\infty i^nJ_n(k)e^{in\theta}$ in Bessel functions is useful when performing the angular integrals.  Then comment that it will be somewhat like a realization of a Gaussian random field in ${\bf k}$ if there are many oscillons.  The key is that we get various local minima and maxima, but these generally have wavelengths of order the gridding in k-space and don't lead to dramatic changes in the slope, only sampled oscillations in it.}

\subsubsection{Parameter dependence}
\jb{Show how it scales with density and oscillon properties.}
Let's now consider how we expect the signal to scale with various properties of the oscillons.
For simplicity, here we will assume that all of the oscillons have a single profile, characterized by an overall oscillation amplitude $\phi_0$, width $\sigma$, and oscillation frequency $\omega$.
Furthermore, we assume that the oscillation frequency and width satisfy $\omega\sigma \sim 1$.
Thus, we do not explicitly consider flat-top oscillons, or potentials supporting a diverse range of oscillon shapes.
However, we expect that this will introduce additional ``stochastic'' effects from the random selection of a profile at each oscillon positions, but not qualitatively new morphological features beyond those explored here. 
\jb{Can relax a bit, since the energy of an oscillon is the key thing.  The last relation between $\omega$ and $\sigma$ is needed in the energy estimate.}
It is convenient to describe the resulting population of oscillons by their number density
\begin{equation}
  n_{\rm osc} = \frac{N_{\rm osc}}{a^3V}
\end{equation}
and energy
\begin{equation}
  E_{\rm osc} \sim \phi_0^2\omega^2\sigma^3
\end{equation}
where $V$ is the comoving volume.
This characterization is convenient, since $E_{\rm osc}$ will be a property solely of the potential under consideration, while $n_{\rm osc}$ encodes information about the initial conditions and complex multi-oscillon interactions.
\jb{Make sure to comment about what is being fixed and what is varied.  Fix notation of $\sigma$ to just capture the total size of the oscillon, not necessarily a thin boundary layer.  Then use a different scale in the definition of $\tilde{F}_0$ above since that has gradients in it.}

We will tackle two limiting cases of interest: the oscillons form the dominant energy component in the Universe, and the oscillons are subdominant to some other component.
For this purpose, it is convenient to define the fractional energy density of the oscillons emitted as gravitational waves
\begin{equation}
  \Omega_{\rm GW}^{\rm osc} \equiv \frac{1}{\rho_{osc}}\frac{\ud\rho_{\rm GW}}{\ud\ln k} = \frac{3H^2M_P^2}{\rho_{\rm osc}}\Omega_{\rm GW}
\end{equation}
where $\rho_{\rm osc}$ is the energy density in oscillons.
We have
\begin{equation}
  \rho_{\rm osc} = n_{\rm osc}E_{\rm osc} \sim (n_{\rm osc}a^3)\omega^2\phi_0^2 \, .
\end{equation}
Consider first the case where $\rho_{\rm tota} \approx \rho_{\rm osc}$, so that $w=0$ and
\begin{equation}
  H_0^3V \sim N_{\rm osc}\sqrt{n_{\rm osc}\sigma^3} \, .
\end{equation}
As argued above, we expect $\rho_{\rm GW}$ to roughly scale as $N_{\rm osc}$ in this case, so in this case we have
\begin{equation}
  \Omega_{\rm GW} \sim (n_{\rm osc}\sigma^3)^{-1/2} \, .
\end{equation}
\jb{Put in all the other scalings.}
\jb{This changes for time-dependent $N_{\rm osc}$.  Fix various factors of $a$.}
\jb{Change the splitting of the expression in the previous section.}

\jb{Add subdominant case, where scalings are $\phi_0^4$}
\jb{There must be more logical combinations of $\phi_0$,$\omega$ and $\sigma$ to consider the scalings with respect to.  Figure out what these are.}



\section{Gravitational Waves in the Discretum}
Having established the general formalism for production of gravitational waves by long-lived scalar sources, we now investigate how various finite-differencing approximations may influence numerically obtained results.
In this work, we will isolate the effects independently of each other as much as possible.
Of course, in an actual application this will typically not be the case, and various discretization errors will interact with each other in (typically nonlinear) ways.
A precise characterization of the theoretical error induced by typical discretization procedure thus requires a holistic approach.
However, the unified approach also mixes various distinct effects together and makes it difficult to discern how various approximations feed into the computed GW spectrum.
Therefore, to provide the reader with as much intuition as possible, we follow a modular approach here.
In principle, combining the analyses presented below will allow for a complete analysis of a given numerical setup.

We will consider the effects of the numerical approximation to the Laplacian, and the interplay between the differentiation operators used to define $T_{ij}$ and the TT projection operators.
For the case of long-lived field configurations, in particular, we will find that a cavalier attitude towards the relationship between derivative operators used to define field derivatives $\partial_i\phi$ and projection operators can lead to artificial gravitational wave power leaked from the physical scalar sector of the true stress-energy tensor.
Such artificial leakage can lead to radically incorrect inferences about the produced $\Omega_{\rm GW}$ since the scalar sector of $T_{ij}$ is many orders of magnitude larger than the tensor sector, so even a small fractional numerical leakage can easily swamp the true signal.
The results obtained above make no direct assumptions about the physical vs. numerical nature of the source $\tij$, so we will be able to apply them in the following with essentially no modification.

\jb{Lay out all the necessary definitions of effective wavenumbers here.  For a projector assumed to factorize there are 4 different effective wavenumbers.  Fixing up the projector is non-trivial, going to leave for another paper.}

As mentioned previously, derivative operators enter in four distinct places in the standard formalism used to estimate gravitational wave production for extended stochastic sources using lattice simulations.
In addition, as is clear from our derivation of the real-space TT projection in~\secref{sec:gw-narrow-band}, the definition of the transverse-traceless projection requires a notion of multiple differentiation operators.
In a careful treatment, one must take care that all of these notions of differentiation are defined self-consistently, most readily by working directly with a discretized version of the action as opposed to the equations of motion.
However, for any reasonable definitions, deviations from both the continuum results and loss of self-consistency will be small in the IR.
Most sources of stochastic gravitational waves studied in the preheating literature arise from either linear field dynamics (where a consistent set of operators is easy to obtain explicitly) or from a short-lived strongly mode-mode coupled stage with the dominant dynamics occurring in the IR region of the lattice.
As a result, issues of consistency are less important in this case.
However, for the case of long-lived sources in an expanding universe, two factors arise that require considerable more care: small errors can build up over time if the integration is carried out long enough, and the relevant dynamics can continuosly shift to the UV region of the discrete lattice causing various discretization errors to become important.

Our purpose here is not to carry out the daunting task of obtaining a fully self-consistent set of differentiation and projection operators.
Therefore, we will make the assumption that the Fourier space representation of the TT projector can be written in a factored form
\begin{equation}
  \Lambda_{ij,lm} = \Lambda_{il}\Lambda_{jm} - \frac{1}{2}\Lambda_{ij}\Lambda_{lm}
\end{equation}
with
\begin{equation}
  \Lambda_{ij} = \delta_{ij} - \frac{{\keffProj}_i{\keffProj}_j}{(\keffProj)^2} \, .
\end{equation}
This approximation is ubiquitous in the literature, and so the results we present below with be applicable to all existing methods used in the literature.
\jb{Does anyone know if there's a reason why the discrete projector has to take this factorized form?  If it does, then ensuring that the trace is projected out and maintaining transversality with respect ot the discrete $T_{ij}$ seem to be inconsistent with each other.  The obvious way out is to use a projector that doesn't factorize, which doesn't that crazy since derivatives of vectors are needed in defining the TT component, and the vectors themselves should probably be defined on links between the lattice sites.}

\jb{Also assume a factorized $T_{ij}$ for simplicity.}

With this simplification, an arbitrary discretization scheme can introduce four different effective wavenumbers in Fourier space.
\jb{List them, and define them}

\subsection{Discrete Laplacian Evolution}
Before considering the projection of $\partial_i\phi\partial_j\phi$, we first consider the interaction between the TT projection and the choice of Laplacian operator to evolve $h_{ij}$ with.
In order to directly connect with common numerical approach, and contrast them with the continuum formulation, here we will briefly derive the necessary modifications to the formalism above for the case when $h_{ij}$ is evolved using a finite-differencing approximation for the Laplacian.

We continue to work in conformal time
\begin{equation}
  h_{ij}'' + 2\mathcal{H}h_{ij}' - L[h_{ij}] = \frac{2}{M_P^2}a^2\pi_{ij}
\end{equation}
where we have now replaced $\nabla^2$ with a discrete lattice representation
\begin{equation}
  L[f](x_i) \equiv \frac{1}{dx^2}\sum_l c_{\vec{\alpha}_l}\left(f(x_{i+\vec{\alpha}_l})-f(x_i)\right)
\end{equation}
for some suitable choices of $c_{\vec{\alpha}_i}$.
As before, it is convenient to instead work with $\bar{h}_{ij} \equiv ah_{ij}$
\begin{equation}
  \bar{h}_{ij}'' - L[\bar{h}_{ij}] - \frac{a''}{a}\bar{h}_{ij} = \frac{2}{M_P^2}a\pi_{ij} \, .
\end{equation}
Fourier transforming, we obtain
\begin{equation}
  \bar{h}_{ij}''(\kvec) + \left(\keffH^2(\kvec) -\frac{a''}{a}\right) \bar{h}_{ij}(\kvec) = \tij(\kvec) 
\end{equation}
with the effective wavenumber
\begin{equation}
  \pi^2\frac{\keffH^2(\kvec)}{\knyq^2} = \sum_{\vec{\alpha}} c_{\vec{\alpha}}\left[2\sin^2\left(\pi\frac{\vec{\alpha}\cdot\kvec}{2\knyq}\right) - i\sin\left(\pi\frac{\vec{\alpha}\cdot\kvec}{\knyq}\right) \right] \, .
\end{equation}
For a symmetric stencil $c_{\vec{\alpha}}=c_{-\vec{\alpha}}$, the imaginary part is zero.
\jb{Check sign of FT convention and imaginary part.}
\jb{Write out Green's function solution, project it, and comment on how the conversion of a fixed $T_{ij}$ is converted into $h_{ij}$.  To isolate effect, can just pretend that the $T_{ij}^{TT}$ projection is exact.}
The corresponding solution for $h_{ij}$ with initial conditions $h_{ij}(\tau_i) = 0 = h_{ij}'(\tau_i)$ is
\begin{subequations}
\begin{align}
  h_{ij}(\kvec,\tau) &= \frac{2}{M_P^2}\int_{\tau_i}^\tau d\tau' \frac{\sin(\keffH(\kvec))(\tau-\tau')}{\keffH(\kvec)}a(\tau')\tij(\kvec,\tau') \\
  h'_{ij}(\kvec,\tau) &= \frac{2}{M_P^2}\int_{\tau_i}^\tau d\tau' \cos(\keffH(\kvec))(\tau-\tau')a(\tau')\tij(\kvec,\tau') \, .
\end{align}
\end{subequations}
\jb{Do projections on this to see effects of mixing induced by propagator, and to check commutativity of projection and time-integration.}

Finally, for the gravitational wave power, we find that~\eqref{eqn:} is replaced by
\begin{equation}
  S_{\bf k} = \frac{k^3}{2M_P^2Va^4}\int d\Omega_k\sum_{ij}\left(\left|\int_{\tau_i}^\tau d\tau'\cos(\keffH(\kvec)\tau')\cos^2(\omega \tau')\tilde{\tijNoT}^{TT}(\kvec,\tau')\right|^2 + \left|\int_{\tau_i}^\tau d\tau'\sin(\keffH(\kvec)\tau')\cos^2(\omega \tau')\tilde{\tijNoT}^{TT}(\kvec,\tau')\right|^2 \right)
\end{equation}
\jb{Check the above to make sure I didn't implicitly drop any angular dependence.}
The modified dispersion relationship from the discrete Laplacian thus leads to two effects:
\begin{enumerate}
\item a modification of the overall amplitude of the signal from the angular dependence of $\keffH$, and
\item a shifting of the wavenumber magnitude that the contribution from a given $\kvec$ is generated at.
\end{enumerate}
In particular, for sources of fixed physical size such as those studied above, the second effect will cause the cutoff in the GW spectrum to shift to the right in physical wavenumbers as the produced waves begin to approach the Nyquist frequency.

\jb{As it relates to the PRL, discretum effects cause the cutoff in the spectrum to move to the right, and since the source is presumably increasing in amplitude as the finite-differencing effects increase, the slope of the ``peak'' will also increase.  This is clearly what qualitatively happens in the PRL plot.  This is of course ignoring errors in time-stepping.}

\subsection{Projection of $T_{ij}$}

\subsection{Grid Based Evaluation: Binning}
A final effect of discretization that we will consider is that the continuum integrals above are no longer evaluated exactly, but instead by sampling at the discrete wavenumbers determined by the lattice of wavenumbers in Fourier space.
\jb{Go through how the implicit binning induced by the discrete k grid folds into the final answer.  There's an implicit window function induced on the angle averaged spectrum.  As well, having the spectrum integrate to the GW energy density on the lattice and correctly reproducing the continuum are probably in tension with each other.}

\subsection{Effects of Discrete Evolution of $\phi$}
\jb{In this section, the effective wavenumbers are for the $T_{ij}$ derivatives.}
We now briefly comment on the effects of discretization on the evolution of the underlying scalar fields $\phi$, and how this feeds into the GW source.
Recall, that our ultimate goal is to determine $\Omega_{\rm GW}$ in the actual continuum theory, not just in its discrete approximatino.
Therefore, even if we take care to ensure that no artificial projection occurs once an external source $T_{ij}$ is provided, the numerical stress-energy tensor obtained from a discrete simulation may artificially generate gravitational waves from discretization errors in the evolution of $\phi$.

First, consider the $\tilde{T}_{ij}(\kvec)$ expressed directly as a convolution of the fields
\begin{equation}
  \tilde{T}_{ij}(\kvec) = \int \ud[3]{\myvec{p}}\ud[3]{\myvec{q}} \delta^{\rm (3)}\left(\kvec - \myvec{p}-\myvec{q}\right)\left(iq_{{\rm eff},i}\right)\left(ip_{{\rm eff},j}\right)\tilde{\phi}(\myvec{p})\tilde{\phi}(\myvec{q}) \, .
\end{equation}
\jb{This assumes a factorized definition of the stress-energy.  Now apply projector as well (or else do this above somewhere).  Change effective wavenumber notation here.}

We already see a complication induced by nonlinearity, while the differential operators are sensitive to the effective wavenumber of the $\partial_i\phi$ stencil, the convolution (here expressed as a $\delta$-function) directly sees the underlying true wavenumber.
A similar issue arises in the dynamics of the scalar field itself, and presents a nontrivial hurdle to the use of discrete approximations to the derivative operator (unless one resorts to a properly resolved pseudospectral code).

Note that if we could somehow arrange our discretization scheme for the $\phi$ evolution so that $\tilde{\phi}^{\rm num}(\kvec) = \tilde{\phi}^{\rm exact}(\kvec_{\rm eff})$,
then we could simply interpret $\tilde{T}_{ij}^{\rm num}(\kvec) = \tilde{T}_{ij}^{\rm exact}(\kvec_{\rm eff})$.
A special case where this occurs is for the linear evolution of perturbations to $\phi$ around a homogeneous background.
In typical preheating scenarios, a significant fraction of the gravitational wave generation occurs while the fluctuations experience linear instabilities of various sorts.
\jb{Insert the linear field part here.  Mention that there are multiple $\kvec_{\rm eff}$ in general, unless the stencils are all derived self-consistently.  Worth doing all this explicitly for some common stencils.}

However, any gravitational waves produced by nonlinearly bound objects such as oscillons are of a qualitatively different nature, as the nonlinear interactions are a fundamental reason for the (quasi)stability of such objects.
In this case (see below), the linear part of the field evolution feels $\kvec_{{\rm eff},\phi}$, while the nonlinear interactions feel the true wavenumber $\kvec$.
The interpretation of the discrete $T_{ij}$ in terms of the true continuum result is thus murky in this context.
\jb{For an oscillon, is it best to expand the equation of motion in some other eigenmodes of the Laplacian?  Of course, wavenumbers are no longer the relevant quantity in that case, and the whole formalism should really be reworked.}

\subsubsection{Linear Field Evolution}
\jb{Write linearized equation.}
We thus see that the dynamics of linear fluctuations behave evolve identically to the exact fluctuations with wavenumber given by $\kvec_{{\rm eff},\phi}$.
Therefore, if we initialize our initial field fluctuations taking this modified wavenumber into accout, throughout a regime of linear evolution we can interpret $\delta\tilde{\phi}^{\rm num}({\kvec})$ as $\delta\tilde{\phi}^{\rm exact}({\kvec})$.
\jb{Fix this to have correct $\kvec_{\rm eff}$.}

\subsubsection{Comments on Nonlinear Field Evolution}
\jb{Write nonlinear equation, showing convolution in potential again sees true wavenumber.}

\jb{Hopefully understanding this makes it obvious why only the $g^2$ contribution below survives the modified projector.}

\section{Example: Gaussian Field Profile}
With the basic formalism in place, we now compute the effects of numerical discretization on some simple field profiles motivated by the dynamics of nonlinear scalar fields.
We will be able to explore the interactions between the various effective wavenumbers introduced by various discretization schemes, and how they eventually combine to give a numerically computed gravitational wave signal.
The analysis we present will very accurately capture the effects of discretization in the $h_{ij}$ Laplacian, definnition of $T_{ij}$ and TT projection operator.
By choosing an ansatz for $\phi$, we cannot to study in precise detail how discretization effects in the field evolution eventually feed into the GW signal.
However, the qualitative effects of the finite-differencing are to enumerate, so even this simplified analysis will allow us to gain valuable insight into this more complicated question as well.

As a first case, consider a Gaussian field profile
\begin{equation}
  \phi(x,y,z) = e^{-\sum\frac{x_i^2}{2\sigma_i^2}}
\end{equation}
with the widths $\sigma_i$ taken as free parameters.

First, we assume $\sigma_x=\sigma_y=\sigma_z=\sigma$.
In the continuum, it is straightforward to see that (here we drop the diagonal Lagrangian contribution)
\begin{subequations}
\begin{align}
  \Pi_{ij} = \frac{x_ix_j}{\sigma^4}e^{-x^2/\sigma^2}
\end{align}
\end{subequations}
with the remaining components easily obtained via the obvious substitutions.
Fourier transforming, we obtain
\begin{align}
  \tilde{\Pi}_{xx}({\bf k}) &= \pi^{3/2}\frac{\sigma}{2}e^{-\sigma^2k^2/4}\left(1-\frac{\sigma^2k_x^2}{2}\right) \\
  \tilde{\Pi}_{xy}({\bf k}) &= -\pi^{3/2}\frac{\sigma}{4}e^{-\sigma^2k^2/4}(\sigma k_x)(\sigma k_y)
\end{align}

For notational convenience, let's define
\begin{equation}
  \mathcal{A}(k) = \pi^{3/2}\sigma e^{-\frac{\sigma^2k^2}{4}}
\end{equation}
and combine the previous expressions
\begin{equation}
  \tilde{\Pi}_{ij} = \frac{\aSym}{2}\left(\delta_{ij} - \frac{\sigma^2k^2}{2}\hat{k}_i\hat{k}_j\right) \, .
\end{equation}
We have the following contractions of $\tilde{\Pi}_{lm}$
\begin{subequations}
\begin{align}
  \tilde{\Pi}_{ll} &= \frac{\aSym}{2}\left(3-\frac{\sigma^2k^2}{2}\right) \\
  \tilde{\Pi}_{ij}\tilde{\Pi}_{ji} &= \frac{\aSym^2}{2} + \left(\frac{\mathcal{A}}{2}\right)^2\left(1-\frac{\sigma^2k^2}{2}\right)^2 \\
  \hat{k}_l\tilde{\Pi}_{li} &= \frac{\aSym}{2}\hat{k}_i\left(1-\frac{\sigma^2k^2}{2}\right) \\
  \hat{k}_l\tilde{\Pi}_{lm}\hat{k}_m &= \frac{\aSym}{2}\left(1-\frac{\sigma^2k^2}{2}\right) \\
  \hat{k}_l\tilde{\Pi}_{la}\tilde{\Pi}_{am}\hat{k}_m &= \frac{\aSym^2}{4}\left(1-\frac{\sigma^2k^2}{2}\right)^2 \, .
\end{align}
\end{subequations}
We readily find that $\Pi_{ij}$ is purely scalar as expected, with
\begin{equation}
  \tilde{\Pi}_{ij}^{{\rm scalar}}({\bf k})
  = \frac{\mathcal{A}(k)}{2}\left(\delta_{ij}-\hat{k}_i\hat{k}_j\frac{\sigma^2k^2}{2}\right)
  = \frac{\aSym}{2}\delta_{ij}\left(1-\frac{\sigma^2k^2}{6}\right) - \aSym\left(\hat{k}_i\hat{k}_j-\frac{1}{3}\delta_{ij}\right)\frac{\sigma^2 k^2}{4}
  = \tilde{\Pi}_{ij} \, .
\end{equation}
Therefore, as required by the spherical symmetry, in the absence of numerical errors this field profile will not produce any gravitational radiation.
This, provides and important null test for any numerical procedure.

\subsection{Factorized Stress-Eenergy Tensor}
Now, let's consider the effects of using a finite-difference approximation to compute the TT part of the stress-energy tensor.
We first used the factorized definition of $T_{ij}$ by introducing
\begin{equation}
  D_x[\phi](x) = \frac{\sum_{\alpha}d_\alpha \phi(x_i+ \alpha dx)}{2dx}
\end{equation}
with analogous definitions for the other directions.
In order to illustrate the issues, when performing analytic calculations we will take
\begin{equation}
  \label{eqn:deriv_order_1}
  D_x[\phi](x) = \frac{1}{2dx}\left(\phi(x+dx,y,z)-\phi(x-dx,y,z)\right) \, .
\end{equation}
The effective wavenumber associated with this discrete stencil is easily seen to be
\begin{equation}
  k_{{\rm eff},i} = \frac{1}{dx}\sin\left(k_idx\right) = \frac{\knyq}{\pi}\sin\left(\pi\frac{k_i}{\knyq}\right) \, .
\end{equation}
\jb{Need to introduce the ``reduced'' stress-tensor with the Lagrangian times identity removed.}
Let's denote the stress-tensor obtained this was as
\begin{equation}
  \label{eqn:tij_factor}
  \pi_{ij} \equiv D_i[\phi]D_j[\phi] \, .
\end{equation}
For linear fluctuations, the corresponding discrete projection operator is
\begin{equation}
  \Lambda_{ij,lm} = P^{d}_{il}P^{d}_{jm} - \frac{1}{2}P^d_{ij}P^{d}_{lm}
\end{equation}
with
\begin{equation}
  P^{d}_{ij} = \delta_{ij} - \frac{\kzero_i\kzero_j}{\kzero^2} \, .
\end{equation}
\jb{Fix this effective $k$ notation.}

Note that this choice of discretization is already inconsistent with typical evolution schemes for both $\phi$ and $h_{ij}$ which often rely on second order accurate and second order isotropic Laplacian stencils.   However, the trace of $\pi_{ij}$ does not match the self-consistent definition of the isotropic pressure that is needed to evolve the Hubble constant.
Neverless, as our point is to illustrate how discretization errors lead to numerical artifacts, we will proceed.
\jb{Insert a definition that's actually consistent with the trace being the isotropic pressure.  In the section on field dynamics, show how the mismatch in discrete derivs already spoils the projection for linear fluctuations.}

Explicitly, for the second order accurate stencil~\eqref{eqn:deriv_order_1} combined with~\eqref{eqn:tij_factor}, we have
\begin{align}
  \pi_{ij} &= \frac{e^{-\frac{x^2}{\sigma^2}}}{\sigma^2}e^{-\frac{dx^2}{\sigma^2}}\left(\frac{\sigma}{dx}\right)^2\sinh\left(\frac{x_idx}{\sigma^2}\right)\sinh\left(\frac{x_jdx}{\sigma^2}\right) 
\end{align}

Fourier transforming and using
\begin{equation}
  \int dx e^{ikx}e^{-x^2/\sigma^2}e^{Jx} = \sqrt{\pi\sigma^2}e^{\frac{\sigma^2 J^2}{4}}e^{-\frac{\sigma^2 k^2}{4}}e^{i\sigma^2kJ/2} \, ,
\end{equation}
so that
\begin{equation}
  \int dx e^{ikx}e^{-x^2/\sigma_i^2}\sinh\left(\frac{xdx}{\sigma_i}\right) = i\sqrt{\pi\sigma_i^2}e^{\frac{dx^2}{4\sigma_i^2}}e^{-\frac{\sigma_i^2k^2}{4}}\sin\left(\frac{kdx}{2}\right)
\end{equation}
we trivially obtain
\begin{subequations}
\begin{align}
  \tilde{\pi}_{xx}({\bf k}) &= \frac{\pi^{3/2}\sigma^3}{2}e^{-\sigma^2 k^2/4}\frac{1}{\sigma^2}\left(\frac{\sigma}{dx}\right)^2\left(1-e^{-\frac{dx^2}{\sigma^2}} - 2\sin^2\left(\frac{k_xdx}{2}\right)\right) \\
  &= \frac{\pi^{3/2}\sigma^3}{2}e^{-\sigma^2 k^2/4}\frac{1}{\sigma^2}\left(\frac{\sigma}{dx}\right)^2\left(\cos(k_xdx) - e^{-\frac{dx^2}{\sigma^2}}\right) \\
  \tilde{\pi}_{xy}({\bf k}) &= -\pi^{3/2}\sigma^3e^{-\frac{\sigma^2k^2}{4}}\frac{1}{\sigma^2}\left(\frac{\sigma}{dx}\right)^2\sin\left(\frac{k_xdx}{2}\right)\sin\left(\frac{k_ydx}{2}\right)e^{-\frac{dx^2}{2\sigma^2}}
\end{align}
\end{subequations}
We can combine these expressions as
\begin{equation}
  \tilde{\pi}_{ij} = \frac{\mathcal{A}}{2}\left(\frac{\sigma}{dx}\right)^2\delta_{ij}\left[\left(1-e^{-\frac{dx^2}{\sigma^2}}\right) - \frac{1}{2}\left(1-e^{-\frac{dx^2}{2\sigma^2}}\right)4\sin^2\left(\frac{k_idx}{2}\right)\right] - \frac{\mathcal{A}}{4}\left(\frac{\sigma}{dx}\right)^2e^{-\frac{dx^2}{2\sigma^2}}2\sin\left(\frac{k_idx}{2}\right)2\sin\left(\frac{k_jdx}{2}\right)
\end{equation}
Comparing the analytic result with the finite-difference approximation, we see that discretisation errors enter in two distinct ways: $k_idx$-dependent contributions resulting from the non-trivial Fourier space structure of the spatial stencils, and $\sigma^{-1}dx$ contributions arising directly from discretisation errors in the finite-difference derivatives.
It is also worth noting that the nonlinear nature of $\pi_{ij}$ has at some level changed the effective wavenumber that we would have naively associated with our finite-differencing stencils for the derivatives.  This interpretation is not completely clean, since overall scaling factors that depend explicitly on $dx$ also appear, but it nonetheless serves the illustrate some of the pitfalls involved with discretization.
\jb{Find another way to write this so that the linear and nonlinear effects are manifestly separated.}

To separate the effects of loss of resolution of the localised Gaussian versus distortion effects of the finite-differencing on large wavenumbers, it is convenient to introduce the following definitions
\begin{equation}
  f(x) \equiv \frac{1-e^{-2x}}{2x} = e^{-x}\frac{\sinh(x)}{x} \qquad g(x) \equiv 1-e^{-2x} = 2e^{-x}\sinh(x)
\end{equation}
which have the following limits for $0 < x \ll 1$
\begin{equation}
  f \approx 1-x \qquad g \approx 2x \, .
\end{equation}
Further, for notational simplicity, we introduce the following effective wavevectors
\jb{Rewrite this section so that $\sigma$ isn't folded into the definitions of the wavenumbers.}
\begin{subequations}
\begin{align}
  \kzero_i &\equiv \frac{2\sigma}{dx}\sin\left(\frac{k_idx}{2}\right) \approx \sigma k\hat{k}_i \\
  \ktwo_i &\equiv \hat{k}_i\frac{2\sigma}{dx}\sin\left(\frac{k_idx}{2}\right) = \hat{k}_i\kzero \approx \sigma k\hat{k}_i^2
\end{align}
\end{subequations}
where the approximate equalities hold for $k_idx \ll 1$.
We also will use the following natural definitions
\begin{equation}
  \kzero^2 \equiv \sum_i\kzero_i^2 = \left(\frac{2\sigma}{dx}\right)^2\sum_i\sin^2\left(\frac{k_idx}{2}\right) \approx \sigma^2k^2
\end{equation}
\begin{equation}
  \ktwo^2 \equiv \sum_i\ktwo_i^2 = \sum_i \hat{k}_i^2\left(\frac{2\sigma}{dx}\right)^2\sin^2\left(\frac{k_idx}{2}\right) \approx \sigma^2k^2\sum_i\hat{k}_i^4
\end{equation}
and
\begin{equation}
  \kone \equiv \sum_i\ktwo_i = \sum_i\hat{k}_i\frac{2\sigma}{dx}\sin\left(\frac{k_idx}{2}\right) \approx \sigma k\sum_i\hat{k}_i^2 = \sigma k
\end{equation}

We can now re-express $\tilde{\pi}_{ij}$
\begin{align}
  \tilde{\pi}_{ij} &= \frac{\aSym}{2}\delta_{ij}\left[f\left(\frac{dx^2}{2\sigma^2}\right) - \frac{1}{2}g\left(\frac{dx^2}{4\sigma^2}\right)\kzero_i\kzero_j\right] - \frac{\aSym}{4}e^{-\frac{dx^2}{2\sigma^2}}\kzero_i\kzero_j \\
  &= \frac{\aSym}{2}\left(\delta_{ij}f - \frac{1}{2}\kzero_i\kzero_j\right) + \frac{\aSym}{4}g\left(\frac{dx^2}{4\sigma^2}\right)\kzero_i\kzero_j\left(1-\delta_{ij}\right)
\end{align}
and
\begin{align}
  \tilde{\pi}_{il}\tilde{\pi}_{lj} &= \left(\frac{\aSym}{2}\right)^2\delta_{ij}\left(f^2 - fg\tilde{k}_i\tilde{k}_j + \frac{g^2}{4}\tilde{k}_i^2\tilde{k}_j^2\right) - \tilde{k}_i\tilde{k}_je^{-\frac{dx^2}{2\sigma^2}}\left(\frac{\aSym}{2}\right)^2\left( f- \frac{g}{4}\left(\tilde{k}_i^2+\tilde{k}_j^2\right) - \frac{e^{-\frac{dx^2}{2\sigma^2}}}{4}\tilde{k}^2\right) \\
  &= \left(\frac{\aSym}{2}\right)^2\left(\delta_{ij}f^2 - f\kzero_i\kzero_j+\frac{\kzero^2\kzero_i\kzero_j}{4}\right) + 
\end{align}

As before, we compute
\begin{subequations}
  \begin{align}
    \tilde{\pi}_{ii} &= \frac{\aSym}{2}\left(\frac{\sigma}{dx}\right)^2 \left[3\left(1-e^{-\frac{dx^2}{\sigma^2}}\right) - 2\sum_i\sin^2\left(\frac{k_idx}{2}\right)\right] = \frac{\mathcal{A}}{2}\left(3f\left(\frac{dx^2}{2\sigma^2}\right) - \frac{1}{2}\tilde{k}^2\right) \\
    \tilde{\pi}_{ij}\tilde{\pi}_{ji} &= \frac{\aSym^2}{2}f^2\left(\frac{dx^2}{2\sigma^2}\right) + \left(\frac{\aSym}{2}\right)^2\left(f\left(\frac{dx^2}{2\sigma^2}\right)-\frac{\tilde{k}^2}{2}\right)^2 - \left(\frac{\aSym}{4}\right)^2\left(1-e^{-\frac{dx^2}{\sigma^2}}\right)\left(\tilde{k}^4 - \sum_i\tilde{k}_i^4\right) \\
    \hat{k}_l\tilde{\pi}_{li} &= \hat{k}_i\frac{\aSym}{2}\left(f\left(\frac{dx^2}{2\sigma^2}\right)-\frac{1}{2}g\left(\frac{dx^2}{4\sigma^2}\right)\kzero_i^2\right) - \kzero_i\frac{\aSym}{4}e^{-\frac{dx^2}{2\sigma^2}}\kone = \left(\frac{\aSym}{2}\right)\left(\hat{k}_if - \frac{\kone\kzero_i}{2}\right) + \frac{\aSym}{4}g\left(\kone\kzero_i-\hat{k}_i\kzero_i^2\right) \\
    \hat{k}_l\tilde{\pi}_{lm}\hat{k}_m &= \frac{\aSym}{2}\left[f\left(\frac{dx^2}{2\sigma^2}\right) - \frac{1}{2}g\left(\frac{dx^2}{4\sigma^2}\right)\bar{k}^2 - \frac{e^{-\frac{dx^2}{2\sigma^2}}}{2}\left(\sum_l\bar{k}_l\right)^2 \right]  = \frac{\aSym}{2}\left[f\left(\frac{dx^2}{2\sigma^2}\right) - \frac{\kappa^2}{2} + \frac{1}{2}g\left(\frac{dx^2}{4\sigma^2}\right)\left(\kappa^2 - \bar{k}^2\right) \right] \\
    \hat{k}_i\tilde{\pi}_{il}\tilde{\pi}_{lj}\hat{k}_j &= \left(\frac{\aSym}{2}\right)^2\left(f^2 - f\kappa^2 + \frac{\kappa^2\tilde{k}^2}{4}\right) + \left(\frac{\aSym}{4}\right)^2g^2\left(\kone^2\kzero^2 - 2\kone\hat{k}_i\kzero_i^3 + \hat{k}_i^2\kzero_i^4 \right) + \left(\frac{\aSym}{2}\right)^2g\left(f\kone^2 - f\ktwo^2 - \frac{\kone^2\kzero^2}{2} + \frac{\kone\hat{k}_i\kzero_i^3}{2} \right) \notag \\
    &= \left(\frac{\aSym}{2}\right)^2\left(f^2 - f\kappa^2 + \frac{\kappa^2\tilde{k}^2}{4}\right) - \left(\frac{\aSym}{4}\right)^2\left(1-e^{-\frac{dx^2}{\sigma^2}}\right)\kone^2\kzero^2 + fg\left(\frac{\aSym}{2}\right)^2\left(\kone^2-\ktwo^2\right) + \left(\frac{\aSym}{4}\right)^2g^2\hat{k}_i^2\kzero_i^4 + \left(\frac{\aSym}{2}\right)^2e^{-\frac{dx^2}{2}}\frac{g}{2}\kone\hat{k}_i\kzero_i^3  \, .
  \end{align}
\end{subequations}

\jb{Make the trivial modification to allow for a broader class of projection operators.}
We can directly obtain the TT projection
\begin{align}
  \tilde{\pi}_{ij}^{(T)} &= -\frac{\aSym}{4}\left(1-g\right)\left[\left(\kzero_i-\kone\hat{k}_i\right)\left(\kzero_j-\kone\hat{k}_j\right) - \frac{1}{2}\left(\delta_{ij}-\hat{k}_i\hat{k}_j\right)\left(\kzero^2-\kone^2\right)\right] \notag \\
  &+ \frac{\aSym}{4}g\left(\delta_{ij}\kzero_i^2 - (\delta_{il}\hat{k}_j+\delta_{jl}\hat{k}_i)\hat{k}_l\kzero_l^2 + \hat{k}_i\hat{k}_j\ktwo^2 - \frac{1}{2}(\delta_{ij}-\hat{k}_i\hat{k}_j)(\kzero^2-\ktwo^2)\right)
\end{align}
As well, it is straightforward to obtain the scalar and vector projections
\begin{subequations}
  \begin{align}
    \tilde{\pi}_{ij}^{\rm scalar} &= \frac{1}{2}\delta_{ij}\mathcal{A}\left(f\left(\frac{dx^2}{2\sigma^2}\right) - g\left(\frac{dx^2}{4\sigma^2}\right)\bar{k}^2 - \frac{1}{4}\left[ \tilde{k}^2 - e^{-\frac{dx^2}{2\sigma^2}}(\sum \bar{k}_i)^2\right]\right) \\
       &- \frac{1}{2}\hat{k}_i\hat{k}_j\frac{\mathcal{A}}{4}\left(3e^{-\frac{dx^2}{2\sigma^2}}(\sum\bar{k}_i)^2 - \tilde{k}^2 + 3g\left(\frac{dx^2}{4\sigma^2}\right)\bar{k}^2 \right) \\
    \tilde{\pi}_{ij}^{(V)} &= \mathcal{A}\left(\frac{\sigma}{dx}\right)^2\frac{1}{2}\left[\hat{k}_i\hat{k}_j\sum_a\hat{k}_a2\sin\left(\frac{k_adx}{2}\right)\Sigma_a - \frac{1}{2}\left(\hat{k}_i2\sin\left(\frac{k_jdx}{2}\right)\Sigma_j + \hat{k}_j2\sin\left(\frac{k_idx}{2}\right)\Sigma_i\right) \right] \, .\\
  \end{align}
\end{subequations}
We see that both vector and tensor contributions are generated, as expected.
\jb{Fix this to remove the old notation I was using.}

\jb{Generalize this stuff to arbitrary choice of projection $k_{\rm eff}$, since it's straightforward.}
To apply our preceeding formalism, we now compute
\begin{align}
  \left|\tilde{\pi}^{(T)}_{ij}\tilde{\pi}_{ji}^{(T)}\right| &= \frac{\aSym^2}{32}\left(1-g\right)^2\left(\kzero^2-\kone^2\right)^2 \notag \\
  &+ 2\left(\frac{\aSym}{4}\right)^2\left(\sum\kzero_i^4 + \kone^2\ktwo^2 - 2\kone\sum\kzero_i^2\ktwo_i - \frac{1}{2}\left(\kzero^2-\kone^2\right)\left(\kzero^2-\ktwo^2\right) \right)g(1-g) \\
  &+ \left(\frac{\aSym}{4}\right)^2g^2\left(\sum_i\kzero_m^4\left(1-2\hat{k}_m^2\right) + \frac{\ktwo^4}{2} - \frac{\kzero^4}{2} + \kzero^2\ktwo^2\right) \notag \\
  &= \frac{\aSym^2}{32}\left(1-g\right)^2\left(\kzero^2-\kone^2\right)^2 \notag \\
  &+ 2\left(\frac{\aSym}{4}\right)^2\left(\sum_l\left(\kzero_l^2-\kone\ktwo_l\right)^2 - \frac{1}{2}\left(\kzero^2-\kone^2\right)\left(\kzero^2-\ktwo^2\right) \right)g(1-g) \notag \\
  &+ \left(\frac{\aSym}{4}\right)^2g^2\left(\right) \\
  &\approx \sigma^4k^4\left(\frac{\aSym}{4}\right)^2\left[\frac{\left(1-g\right)^2}{2}\kfrac^8\left(1-\left(\sum\hat{k}_i^4\right)^2\right)^2 + 2\kfrac^4g(1-g) + g^2() \right]
\end{align}
\jb{Rewrite the $g^2$ term in some more obvious form.  The final approximation is not consistent, since I haven't expanded each term to $\kfrac^8$.}
In the final approximate equality we have expanded each term to leading order in $\kfrac \equiv \frac{\pi k}{2\knyq} = \frac{kdx}{2}$.
This is useful when an exact approximation to the Laplacian is used to evolve $h_{ij}$.
When a discrete approximation is used, on the other hand, and expansion in the corresponding $\keffH$ is more appropriate. \jb{Do this expansion.}
Note that the use of a projector consistent with our discrete definition of $T_{ij}$ removes the contributions from the first two lines of this expression, but does not completely remove the third line.
\jb{Check if this is actually true by computing explicitly the rather ugly operator.  Find a nice interpretation in terms of nonlinearity vs linearity if it exists.}

We can now compute the inferred spectrum of gravitational waves that would be produced by an oscillating spherically symmetric Gaussian profile using the standard combination of finite-differencing definition of the stress-energy tensor and continuum projectors.
This provides an important null test, since this configuration produces no gravitational waves in the continuum.
The reader should not interpret this as a precise model for the oscillon dynamics (which even if spherically symmetric may not have a Gaussian radial profile), but rather an important test case to illustrate the shortcomings of the standard approach.
As well, we expect that up to $\mathcal{O}(1)$ corrections, this result should apply to the GW production from any spherically symmetric profile where the radial profile is well characterized by a single length scale.
We will examine how the introduction of a second scale (effectively a boundary layer between the interior and exterior) of the profile modifies this result shortly.

\jb{Show continuum integral result of angle averages, vs the discretely binned result evaluated at lattice momenta, since these are again different in principle.  Probably nicest to also show various effective k combinations and how the integrals look in the two approximations.  With discrete bins, also vary the bin size.  Probably best to also do the power spectrum estimation with some implied window function in the discrete case, c.f. my lattice code for appropriate coefficients.}

\jb{Move this stuff somewhere more logical.}
\begin{figure}
  \caption{Plotting the discrete version of the sum of a unit vector's components squared.  Show how absolutely awful it is once you get anywhere near the Nyquist.  In particular, find some notion of the asymmetry as a function of angle (maybe project onto various spherical harmonics?)}
\end{figure}

At this point, it is extremely unclear that a consistent set of projection operators associated with the given discrete definition of $\pi_{ij}$ can even be found.
This is not surprising, given that the trace of the operator as defined is inconsistent with a Laplacian stencil living on the lattice.
A better choice of discretisation should instead permit some notion of a discrete stencil to properly project out the unphysical numerical artifacts associated with the discrete stencils, which we will explore below.

\begin{figure}
  \includegraphics[width=3.375in]{{{txx-analytic}}}
  \includegraphics[width=3.375in]{{{txy-analytic}}} \\
  \includegraphics[width=3.375in]{{{txx-numerical-dx0.25}}}
  \includegraphics[width=3.375in]{{{txy-numerical-dx0.25}}} \\
  \includegraphics[width=3.375in]{{{txx-diff-dx0.25}}}
  \includegraphics[width=3.375in]{{{txy-diff-dx0.25}}}
  \caption{Comparision of the exact $\Pi_{ij}$ and the finite-difference $\pi_{ij}$ in real space for a single Gaussian.  We see that the numerical errors induce non-trivial structure into the errors with quadrupole and higher contributions.  We expect this to feed into errors in the calculation of gravitational wave energy densities.  In the top row we show the analytic result, in the middle row the numerical approximation, and in the bottom row the difference between the two.  In the left column we show $T_{xx}$ and in the right column $T_{xy}$.  The remaining components can be obtained trivially from these two.  In the case of the numerical stencil, we have taken $dx/\sigma = 0.25$.}
\end{figure}

\begin{figure}
  \includegraphics[width=3.375in]{{{convergence-max-error}}}
  \caption{Maximal real-space error in the calculation of $\Pi_{ij}$ using the finite-difference approximation as a function of the grid spacing $dx / \sigma$.}
\end{figure}

\begin{figure}
  \caption{Fourier space representations of the source.}
\end{figure}

\begin{figure}
  \caption{TT projection using continuum and discrete factorized projectors}
\end{figure}

\begin{figure}
  \caption{Real space TT projection.}
\end{figure}

\begin{figure}
  \caption{Total angular integral of TT component as a function of grid space $\sigma^{-1}dx$.}
\end{figure}

\subsection{Numerical Signal: Exact $h_{ij}$ Laplacian}
We now have all the results necessary to determine the spurious numerical noise in $\Omega_{\rm GW}$ from an underlying oscillating Gaussian field profile using standard discretization schemes.
First we consider the case where the Laplacian in the wave equation for $h_{ij}$ is calculated either in spectral space or using a pseudospectral derivative so that $\keffH = k$.
In the following subsection we will consider also the case where a low-order discrete approximation is used for the Laplacians.

\jb{Get the prefactors so that we can get an order of magnitude estimate of $\Omega_{\rm GW}$ if the oscillons are the dominant contribution to the energy density.}

\subsection{Numerical Signal: Discrete $h_{ij}$ Laplacian}
\jb{The Gaussian prefactor also acquires angular dependence in this case.  Do both the self-consistent with factored $T_{ij}$ definition, and low-order nearest neighbour.}
We now consider instead the case where $h_{ij}$ is evolved with a finite-differencing approximation to the Laplacian.
As shown above, in the leading asymptotic expansion, we must now evaluate $\tijNoT$ at scale factor $a_k = \keffH(\kvec)/2\omega$, which introduces additional angular dependence into the integrand over directions in Fourier space.

\subsection{Numerical Signal: Binning Effects}
\jb{Work out how binning modifies the computed result.}
In the above, we obtained estimates for $\Omega_{\rm GW}$ by performing the angular integrals either analytically or using a quadrature integrator (so that numerical errors are present only at the level of machine precision).
However, a lattice simulation on a fixed rectangular grid instead samples the wavenumbers as discrete values
\begin{equation}
  k_{\vec{i}} = \frac{2\pi}{L}\left(i_x,i_y,i_z\right)
\end{equation}
leading to a discretization of the angular integrals.
Furthermore, these wavenumbers are typically binned, inducing a nontrivial implicit window function of the estimated spectrum.
As a final step, we thus investigate how these choices of binning scheme modify the results from exact angular integrations.
\jb{Due to various discrete symmetries of the $k$ grid that are probably shared by the effective wavenumbers, a lot of possible errors might exactly cancel here, but this is a detail to check.  Also, for asphericity that is \emph{not} aligned with the coordinate axes, this is no longer ture.}

\subsubsection{Naive Binning}
Explain what happens if we just bin things (which introduces extra noise).

\subsubsection{Window Function Binning}
A more sophisticated approach is to view the numerically computed spectrum as a windowed version of some underlying spectrum with output values specified at some selected points $k_{\rm output}$, and determined by samples at some other collection of input values $k_{\rm input}$.
Heuristically, this allows us to assign part of the signal from a given $k_{\vec{i}}$ on the lattice simulation grid to multiple output wavenumbers in our numerical spectrum with appropriately defined weights.
\jb{Put in the equation for arbitrary window, then give an easy example.}


\section{Asymmetric Gaussian}
We now consider a case where the underlying field configuration produces a real gravitational wave signal.
For this, we must complexify our model slightly, which for simplicity we do by allowing the Gaussian to be ellipsoidal with 3 different $\sigma_i$'s.
In the continuum, the result is independent of the embedding of principal axes of the ellipse with respect to the coordinate axes.
However, since a discrete grid explicitly breaks continuous rotational symmetry leaving behind only a discrete subset, this is no longer true in the case of finite difference approximations.
To simplify the algebra, we restrict to the case where the principal axes of the ellipse lie along the coordinate axes.
The more general case allows rotation off of this configuration, which allows us to explore the influence of the anisotropy of the finite difference stencil.

\subsection{Exact Result}
We first derive the exact GW signal produced by such a configuration.
The reduced stress-energy tensor is
\begin{equation}
  \Pi_{ij} = \frac{x_ix_j}{\sigma_i^2\sigma_j^2}e^{-\sum\frac{x_i^2}{\sigma_i^2}}
\end{equation}
whose Fourier transform is
\begin{align}
  \tilde{\Pi}_{xx} &= \pi^{3/2}\left(\Pi_i\sigma_i\right)e^{-\frac{1}{4}\sum_i\sigma_i^2k_i^2}\frac{1}{2\sigma_x^2}\left(1-\frac{\sigma_x^2k_x^2}{2}\right) \\
  \tilde{\Pi}_{xy} &= -\pi^{3/2}\left(\Pi_i\sigma_i\right)e^{-\frac{1}{4}\sum_i\sigma_i^2k_i^2}\frac{1}{4\sigma_x\sigma_y}\sigma_xk_x\sigma_yk_y
\end{align}
\begin{align}
  \label{eqn:Piij-asymmetric}
  \tilde{\Pi}_{ij} &= \pi^{3/2}(\sigma_x\sigma_y\sigma_z)e^{-\frac{1}{4}\sigma_i^2k_i^2}\frac{1}{2\sigma_i\sigma_j}\left(\delta_{ij} - \hat{k}_i\hat{k}_j\frac{\sigma_i\sigma_jk^2}{2}\right) \\
  &= \pi^{3/2}(\sigma_x\sigma_y\sigma_z)e^{-\frac{1}{4}\sigma_i^2k_i^2}\frac{1}{2s^2}\left(\delta_{ij}-\frac{s^2k^2}{2}\hat{k}_i\hat{k}_j\right) + \frac{\aAsym}{2s^2}\delta_{ij}\left(\frac{s^2}{\sigma_i^2}-1\right)
\end{align}
where $s$ is a parameter with dimensions of length and we defined
\begin{equation}
  \aAsym = \pi^{3/2}\left(\Pi_i\sigma_i\right)e^{-\frac{1}{4}\sigma_i^2k_i^2} \, .
\end{equation}
The TT contribution to $\tilde{\Pi}_{ij}$ comes entirely from the final term in~\eqref{eqn:Piij-asymmetric}.
It is straightforward to compute
\begin{equation}
  \sum_{i,j}\left|\tilde{\Pi}_{ij}\right|^2 = \frac{\aAsym^2}{4s^4}\frac{1}{2} 
\end{equation}
where we have defined $C_i = s^2/\sigma_i^2 - 1$
As a special case that has been considered previously in the literature, we can consider an asymmetry in only the $\hat{k}_x$ with
\begin{equation}
  \sigma_x = \sigma(1+\Delta) \qquad \sigma_y=\sigma_z = \sigma \qquad s = \sigma
\end{equation}
for which the above equation simplifies to
\begin{equation}
  \sum_{ij}\left|\tilde{\Pi}_{ij}\right|^2 = \frac{\pi^3}{8}\sigma^2e^{-\frac{1}{2}\sigma^2k^2}e^{-\frac{1}{2}\sigma^2k_x^2\Delta(2+\Delta)}\left(\frac{\Delta(2+\Delta)}{1+\Delta}\right)^2\left(1-\hat{k}_x^2\right)^2 \, .
\end{equation}

\begin{subequations}
\begin{align}
  \tilde{\Pi}_{ii} &= \frac{\aAsym}{2}\left(\sum_i\sigma_i^{-2} - \frac{k^2}{2}\right) \\
  \hat{k}_l\tilde{\Pi}_{li} &= \hat{k}_i\frac{\aAsym}{2\sigma_i^2}\left(1-\frac{\sigma_i^2k^2}{2}\right) \\
  \hat{k}_l\tilde{\Pi}_{lm}\hat{k}_m &= \frac{\aAsym}{2}\left[\sigma_a^{-2}\hat{k}_a^2 -\frac{k^2}{2}\right] 
\end{align}
\end{subequations}
\begin{align}
  \tilde{\Pi}_{ii} - \hat{k}_l\tilde{\Pi}_{lm}\hat{k}_m &= \frac{\aAsym}{2}\sum_i\frac{1-\hat{k}_i^2}{\sigma_i^2}\\
  3\hat{k}_l\tilde{\Pi}_{lm}\hat{k}_m - \tilde{\Pi}_{ii} &= -\aAsym\left(\sum_i\frac{3\hat{k}_i^2-1}{2\sigma_i^2} - \frac{k^2}{2}\right)
\end{align}

From which we can easily compute the SVT decomposition
\begin{subequations}
  \begin{align}
    \Pi_{ij}^{\rm scalar} &= \frac{\delta_{ij}}{2}\aAsym\left(\sum_i\frac{1-\hat{k}_i^2}{2\sigma_i^2} \right) + \frac{\hat{k}_i\hat{k}_j}{2}\aAsym\left(\sum_i\frac{3\hat{k}_i^2-1}{2\sigma_i^2}-\frac{k^2}{2}\right)\\
    \Pi_{ij}^{(V)} &= \\
    \Pi_{ij}^{(T)} &=
  \end{align}
\end{subequations}


\subsection{Discrete Result}
\begin{equation}
  \pi_{ij} = \frac{e^{-\sum_i\frac{x_i^2}{\sigma_i^2}}}{\sigma_i\sigma_j}e^{-\frac{dx_i^2}{2\sigma_i^2}-\frac{dx_j^2}{2\sigma_j^2}}\frac{\sigma_i}{dx_i}\frac{\sigma_j}{dx_j}\sinh\left(\frac{x_idx_i}{\sigma_i^2}\right)\sinh\left(\frac{x_jdx_j}{\sigma_j^2}\right)
\end{equation}

\begin{equation}
  \tilde{\pi}_{xx}(\kvec) = \frac{1}{2}\pi^{3/2}(\Pi_i\sigma_i)e^{-\frac{\sigma_i^2k_i^2}{4}}\frac{1}{dx^2}\left(1-e^{-\frac{dx^2}{\sigma_i^2}} - \frac{1}{2}4\sin^2\left(\frac{k_idx}{2}\right)\right)
\end{equation}
\begin{equation}
  \tilde{\pi}_{xy}(\kvec) = -\frac{1}{4}\pi^{3/2}\Pi_i\sigma_ie^{-\frac{\sigma_i^2k_i^2}{4}} e^{-\frac{dx^2}{4\sigma_x^2}}e^{-\frac{dx^2}{4\sigma_y^2}} \frac{4}{dx^2}\sin\left(\frac{k_xdx}{2}\right)\sin\left(\frac{k_ydx}{2}\right)
\end{equation}
\begin{equation}
  \tilde{\pi}_{ij}(\kvec) = \frac{1}{2}\pi^{3/2}(\Pi_i\sigma_i)e^{-\frac{1}{4}\sigma_i^2k_i^2}\left[\left(\frac{\delta_{ij}}{dx^2}(1-e^{-\frac{dx^2}{\sigma_i^2}}) - \frac{1}{2}\kzero_i\kzero_j \right) + \frac{1}{2}\left(1-e^{-dx^2/4\sigma_i^2}e^{-dx^2/4\sigma_j^2}\right)\kzero_i\kzero_j(\delta_{ij}-1)\right]
\end{equation}
\jb{Define $\kzero$ with dimensions here}
\jb{New twist, the equivalent of $f$ here induces a numerical correction (as well as giving the physical part at leading order.  Will have to see how it projects, since both physical and numerical piece vanish for symmetric profile.  Need to see how they grow as asymmetry is introduced, and presumably when the numerical piece takes over.  This piece will survive even correct projector.}

\jb{Finish this to determine when the real signal and the numerical signal are equal to each other (for the case of principal axes aligned with the lattice first).}
\jb{Here we can make a concrete connection for how the scalar dynamics and tensor dynamics interact.  Suppose that the numerical $\phi$ evolution induces an asymmetric Gaussian profile out of a spherically symmetric one.  Computing the cross-term between the ``real'' numerical profile and the ``numerical'' noise term in this section will show if the projection can be used to partially under the numerical error in the $\phi$ profile.  This is by no means a general argument, but it's at least something marginally nontrivial.}

\section{Perturbations from Spherical Harmonic Perturbations to Sphericity}
\begin{equation}
  \phi({\bf x}) = f(r)Y_{lm}(\theta,\phi)
\end{equation}
which also captures the linear perturbation to sphicicity for a profile of the form
\begin{equation}
  \phi({\bf x}) = P\left(r+\epsilon r Y_{lm}(\theta,\phi)\right) \, .
\end{equation}
\jb{Will get cross-talk between the spherically symmetric and perturbation part once we take derivatives.}

\section{Toy Model: Smoothed Spherical Top-Hat}
Rather than the smoothly varying field concentration with only a single scale $\sigma$, we now consider a hierarchical concentration characterized by a boundary layer and an overall size
\begin{equation}
  \phi({\bf x}) = \tanh\left(w^{-1}[r-R_0]\right)
\end{equation}
with $w$ and $R_0$ parameters.
{\bf Perhaps better to use a breather profile to avoid singular derivative at the origin}.
Since this configuration is spherically symmetric, it should not produce any gravitational radiation.
However, we are particularly interested with how inadequate resolution of the boundary layer of width $w$ can source graviational waves, even if the overall radius of the structure $R_0$ is properly resolved.
{\bf With bubbles, for example, this effect modifies propagation speed of the expanding bubble wall, and leads quickly to a very visible effect simply from systematic numerical errors.}



\section{Discretization Schemes}
\subsection{Action-Derivable Definitions}
Here we consider an alternative definition of the discrete operator $\pi_{ij}$, that can be derived from a discrete action formulation of the fields.
{\bf Put in action to quadratic order in $h_{ij}$, vary, show how this operator pops out}.
Suppose we use finite-difference Laplacian stencil
\begin{equation}
  L[\phi](x_i) \equiv \sum_\alpha c_\alpha\left(\phi_{i+\alpha}-\phi_i\right) \, .
\end{equation}
Once this is chosen, we are no longer free to choose the discretisation of $(\nabla\phi)^2$ or the discrete equations of motion will not follow from either the variation of a discrete action or from a discrete Hamiltonian.
This is obvious, since in the action only one differential operator $(\nabla\phi)^2$ appears, which means that $\nabla^2\phi$ is not independent of this definition.
The appropriate definition satisfying summation by parts is
\begin{equation}
  (\nabla\phi)^2(x_i) \to D_2[\phi](x_i) \equiv \sum_\alpha \frac{c_\alpha}{2}\left(\phi_{i+\alpha}-\phi_i\right)^2 \, .
\end{equation}
{\bf check signs.}
Based on this, it is reasonable to instead discretise as follows {\bf fix this so it's correct}
\begin{equation}
  \nabla_i\phi\nabla_j\phi(x_i) \to %\sum_{\alpha}\frac{c_\alpha}{2}\left(\phi_{i+\alpha}-\phi_i\right)\left(\phi_{i+}-\phi_i\right)
\end{equation}
so that we obtain
\begin{equation}
  \mathrm{Tr}(\partial_i\phi\partial_j\phi) = D_2[\phi](x_i)
\end{equation}
consistent with the definition required to conserve energy on the lattice.

\section{Self-Consistent Action Derived Derivatives}
\jb{This is complicated since we have to define derivatives acting on vectors and what exactly a vector means for a purely scalar code.  Probably the factorizability of the TT projector is broken when this is done properly (and some lessons from lattice gauge theory might be useful), but this is a bigger problem than needs to be solved in this paper.}

\section{Appendix: Useful Formulae}
In this appendix we collect some useful results regarding projections of various matrix structures.

\subsection{Contractions}

\subsection{Expansion of Some Effective Wavenumbers}

\section{Elliptic Gaussian}
\jb{Remove this, just used as an algebra check with Antush paper.}
For
\begin{equation}
  f_{ij} = \frac{1}{|\kvec|^4}\left(
  \begin{array}{ccc}
    -k_x^2k_y^2 + k^2k_z^2 & k_xk_y(k_x^2+k_z^2) & -k_xk_z(k^2+k_y^2) \\
    k_xk_y(k_x^2+k_z^2) & -(k_x^2+k_z^2)^2 & k_yk_z(k_x^2+k_z^2) \\
    -k_xk_z(k^2+k_y^2) & k_yk_z(k_x^2+k_z^2) & -k_y^2k_z^2 + k_x^2k^2 
  \end{array}\right)
\end{equation}
we have
\begin{equation}
  |f_{ij}|^2 = 2(1-\hat{k}_y^2)^2 \, .
\end{equation}
which matches the result from my independent calculation.

\end{document}
